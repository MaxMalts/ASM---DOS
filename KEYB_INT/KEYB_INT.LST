Turbo Assembler	 Version 4.1	    02/24/20 18:21:22	    Page 1
keyb_int.asm



      1	0000			     .model tiny
      2	0000			     .code
      3				     org 100H
      4
      5	0100			     Start:
      6	0100  33 C0			     xor ax, ax	     ; mov ax, 0
      7	0102  8E C0			     mov es, ax
      8
      9					     ; Intersepting interrupt:
     10	0104  FA			     cli
     11	0105  BB 0024			     mov bx, 9*4     ; es:[bx] --> int 09H in ISR Table
     12
     13	0108  26: 8B 07			     mov ax, word ptr es:[bx]
     14	010B  A3 013Dr			     mov Old09,	ax
     15	010E  26: 8B 47	02		     mov ax, word ptr es:[bx+2]
     16	0112  A3 013Fr			     mov Old09+2, ax
     17	0115  FB			     sti
     18
     19	0116  26: C7 07	0129r		     mov word ptr es:[bx], offset New09
     20	011B  8C C8			     mov ax, cs
     21	011D  26: 89 47	02		     mov word ptr es:[bx+2], ax
     22
     23
     24					     ; End program but don't unload it from RAM:
     25	0121  B8 3100			     mov ax, 3100H
     26	0124  BA 0147			     mov dx, 147H
     27					     ;shr dx, 4
     28	0127  CD 21			     int 21h
     29
     30
     31	0129			     New09 proc
     32					     ; Save registers:
     33	0129  50 57 06			     push ax di	es
     34
     35
     36	012C  B8 B800			     mov ax, 0b800H
     37	012F  8E C0			     mov     es, ax
     38	0131  E4 60			     in	al, 60H
     39	0133  BF 0370			     mov di, (5*80+40)*2
     40	0136  B4 4E			     mov ah, 4eH
     41	0138  AB			     stosw
     42
     43					     ;in al, 61H
     44					     ;mov ah, al
     45					     ;or al, 80H
     46					     ;out 61H, al    ; To 61 port
     47					     ;mov al, ah
     48					     ;out 61H, al
     49
     50					     ;mov al, 20H
     51					     ;out 20H, al    ; Send end	of interrupt signal
     52
     53					     ; Restore registers
     54	0139  07 5F 58			     pop es di ax
     55
     56					     ; Data here intreprets as code
     57	013C  EA			     db	0eaH	     ; jmp far
Turbo Assembler	 Version 4.1	    02/24/20 18:21:22	    Page 2
keyb_int.asm



     58	013D  0000		     Old09   dw	0	     ; jmp arguments
     59	013F  0000			     dw	0
     60
     61	0141  CF			     iret
     62	0142				     endp
     63
     64				     end Start
Turbo Assembler	 Version 4.1	    02/24/20 18:21:22	    Page 3
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "02/24/20"
??FILENAME			  Text	 "keyb_int"
??TIME				  Text	 "18:21:22"
??VERSION			  Number 040A
@32BIT				  Text	 0
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0101H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 KEYB_INT
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
NEW09				  Near	 DGROUP:0129
OLD09				  Word	 DGROUP:013D
START				  Near	 DGROUP:0100

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0000 Word	  Public  DATA
  _TEXT				  16  0142 Word	  Public  CODE
