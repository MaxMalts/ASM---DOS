Turbo Assembler	 Version 4.1	    02/29/20 23:30:30	    Page 1
keyb_int.asm



      1				     locals @@
      2
      3	0000			     .model tiny
      4
      5				     extrn Message: byte, Draw_Border: near, Draw_Message: near
      6	0000			     .data
      7	0000  00		     borderDrawn db 0
      8
      9
     10	0001			     .code
     11				     org 100H
     12	0100			     Start:
     13	      =0024			     keybInter	     equ 9*4
     14	      =00EA			     jmpFarCommand   equ 0eaH
     15
     16	0100  B8 0000			     mov ax, 0
     17	0103  8E C0			     mov es, ax
     18
     19	0105  BB 0024			     mov bx, keybInter
     20	0108  26: 8B 07			     mov ax, word ptr es:[bx]
     21	010B  A3 016Cr			     mov OldInter, ax
     22	010E  26: 8B 47	02		     mov ax, word ptr es:[bx+2]
     23	0112  A3 016Er			     mov OldInter+2, ax
     24
     25	0115  26: C7 07	0126r		     mov word ptr es:[bx], offset NewInter
     26	011A  26: 8C 4F	02		     mov word ptr es:[bx+2], cs
     27
     28	011E  B8 3100			     mov ax, 3100H   ; Exit program but	don't unload it	from RAM
     29	0121  BA 0241			     mov dx, 241H
     30	0124  CD 21			     int 21H
     31
     32	0126				     NewInter proc
     33	      =0060				     keybPort	     equ 60H
     34	      =002A				     hotKey	     equ 2aH ; left shift
     35
     36	0126  50 53 51 52 1E 06	57+		     push ax bx	cx dx ds es di si
     37	      56
     38
     39	012E  8C C8				     mov ax, cs
     40	0130  8E D8				     mov ds, ax
     41
     42	0132  80 3E 0000r 00			     cmp borderDrawn, 0
     43	0137  75 0E				     jne @@if_borderDrawn
     44	0139  E4 60					     in	al, keybPort
     45	013B  3C 2A					     cmp al, hotKey
     46	013D  75 05					     jne @@not_hotKeyPressed
     47	013F  C6 06 0000r 01					     mov BorderDrawn, 1
     48	0144						     @@not_hotKeyPressed:
     49
     50	0144  EB 1D 90					     jmp @@end_if_borderDrawn
     51	0147					     @@if_borderDrawn:
     52	0147  E8 0000e					     call Draw_Border
     53
     54	014A  E4 60					     in	al, keybPort
     55	014C  C6 06 0000e 00				     mov Message, 0
     56	0151  A2 0001e					     mov Message+1, al
     57	0154  C6 06 0002e 24				     mov Message+2, '$'
Turbo Assembler	 Version 4.1	    02/29/20 23:30:30	    Page 2
keyb_int.asm



     58	0159  BF 0000e					     mov di, offset Message
     59
     60	015C  8C C8					     mov ax, cs
     61	015E  8E C0					     mov es, ax
     62	0160  E8 0000e					     call Draw_Message
     63	0163					     @@end_if_borderDrawn:
     64
     65	0163  5E 5F 07 1F 5A 59	5B+		     pop si di es ds dx	cx bx ax
     66	      58
     67
     68						     ; Data here interprets as code, jumps to old interrupt handler
     69	016B  EA					     db	jmpFarCommand
     70	016C  0000			     OldInter	     dw	0    ; jmp arguments
     71	016E  0000					     dw	0
     72
     73	0170  CF				     iret
     74	0171					     endp
     75				     end Start
Turbo Assembler	 Version 4.1	    02/29/20 23:30:30	    Page 3
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "02/29/20"
??FILENAME			  Text	 "keyb_int"
??TIME				  Text	 "23:30:30"
??VERSION			  Number 040A
@32BIT				  Text	 0
@@END_IF_BORDERDRAWN		  Near	 DGROUP:0163
@@IF_BORDERDRAWN		  Near	 DGROUP:0147
@@NOT_HOTKEYPRESSED		  Near	 DGROUP:0144
@CODE				  Text	 DGROUP
@CODESIZE			  Text	 0
@CPU				  Text	 0101H
@CURSEG				  Text	 _TEXT
@DATA				  Text	 DGROUP
@DATASIZE			  Text	 0
@FILENAME			  Text	 KEYB_INT
@INTERFACE			  Text	 000H
@MODEL				  Text	 1
@STACK				  Text	 DGROUP
@WORDSIZE			  Text	 2
BORDERDRAWN			  Byte	 DGROUP:0000
DRAW_BORDER			  Near	 ----:---- Extern
DRAW_MESSAGE			  Near	 ----:---- Extern
HOTKEY				  Number 002A
JMPFARCOMMAND			  Number 00EA
KEYBINTER			  Number 0024
KEYBPORT			  Number 0060
MESSAGE				  Byte	 ----:---- Extern
NEWINTER			  Near	 DGROUP:0126
OLDINTER			  Word	 DGROUP:016C
START				  Near	 DGROUP:0100

Groups & Segments		  Bit Size Align  Combine Class

DGROUP				  Group
  _DATA				  16  0001 Word	  Public  DATA
  _TEXT				  16  0171 Word	  Public  CODE
